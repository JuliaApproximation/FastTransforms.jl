<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Spherical harmonic addition theorem · FastTransforms.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="FastTransforms.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">FastTransforms.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../chebyshev/">Chebyshev transform</a></li><li><a class="tocitem" href="../disk/">-</a></li><li><a class="tocitem" href="../nonlocaldiffusion/">Nonlocal diffusion on <span>$\mathbb{S}^2$</span></a></li><li><a class="tocitem" href="../padua/">Padua transform</a></li><li class="is-active"><a class="tocitem" href>Spherical harmonic addition theorem</a></li><li><a class="tocitem" href="../spinweighted/">Spin-weighted spherical harmonics</a></li><li><a class="tocitem" href="../triangle/">Calculus on the reference triangle</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Spherical harmonic addition theorem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Spherical harmonic addition theorem</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaApproximation/FastTransforms.jl/blob/master/examples/sphere.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Spherical-harmonic-addition-theorem-1"><a class="docs-heading-anchor" href="#Spherical-harmonic-addition-theorem-1">Spherical harmonic addition theorem</a><a class="docs-heading-anchor-permalink" href="#Spherical-harmonic-addition-theorem-1" title="Permalink"></a></h1><p>This example confirms numerically that</p><div>\[f(z) = \frac{P_4(z\cdot y) - P_4(x\cdot y)}{z\cdot y - x\cdot y},\]</div><p>is actually a degree-<span>$3$</span> polynomial on <span>$\mathbb{S}^2$</span>, where <span>$P_4$</span> is the degree-<span>$4$</span> Legendre polynomial, and <span>$x,y,z \in \mathbb{S}^2$</span>. To verify, we sample the function on a <span>$5\times9$</span> equiangular grid defined by:</p><div>\[\begin{aligned}
\theta_n &amp; = (n+\tfrac{1}{2})\pi/N,\quad{\rm for}\quad 0\le n &lt; N,\quad{\rm and}\\
\varphi_m &amp; = 2\pi m/M,\quad{\rm for}\quad 0\le m &lt; M;
\end{aligned}\]</div><p>we convert the function samples to Fourier coefficients using <code>plan_sph_analysis</code>; and finally, we transform the Fourier coefficients to spherical harmonic coefficients using <code>plan_sph2fourier</code>.</p><p>In the basis of spherical harmonics, it is plain to see the addition theorem in action, since <span>$P_4(x\cdot y)$</span> should only consist of exact-degree-<span>$4$</span> harmonics.</p><p>For the storage pattern of the arrays, please consult the <a href="https://MikaelSlevinsky.github.io/FastTransforms">documentation</a>.</p><pre><code class="language-julia">function threshold!(A::AbstractArray, ϵ)
    for i in eachindex(A)
        if abs(A[i]) &lt; ϵ A[i] = 0 end
    end
    A
end

using FastTransforms, LinearAlgebra</code></pre><p>The colatitudinal grid (mod <span>$\pi$</span>):</p><pre><code class="language-julia">N = 5
θ = (0.5:N-0.5)/N</code></pre><pre><code class="language-none">0.1:0.2:0.9</code></pre><p>The longitudinal grid (mod <span>$\pi$</span>):</p><pre><code class="language-julia">M = 2*N-1
φ = (0:M-1)*2/M</code></pre><pre><code class="language-none">0.0:0.2222222222222222:1.7777777777777777</code></pre><p>Arbitrarily, we place <span>$x$</span> at the North pole:</p><pre><code class="language-julia">x = [0,0,1]</code></pre><pre><code class="language-none">3-element Array{Int64,1}:
 0
 0
 1</code></pre><p>Another vector is completely free:</p><pre><code class="language-julia">y = normalize([.123,.456,.789])</code></pre><pre><code class="language-none">3-element Array{Float64,1}:
 0.13375998748853216
 0.4958906853233388
 0.8580213831581455</code></pre><p>Thus <span>$z \in \mathbb{S}^2$</span> is our variable vector, parameterized in spherical coordinates:</p><pre><code class="language-julia">z = (θ,φ) -&gt; [sinpi(θ)*cospi(φ), sinpi(θ)*sinpi(φ), cospi(θ)]</code></pre><pre><code class="language-none">#1 (generic function with 1 method)</code></pre><p>The degree-<span>$4$</span> Legendre polynomial is:</p><pre><code class="language-julia">P4 = x -&gt; (35*x^4-30*x^2+3)/8</code></pre><pre><code class="language-none">#3 (generic function with 1 method)</code></pre><p>On the tensor product grid, our function samples are:</p><pre><code class="language-julia">F = [(P4(z(θ,φ)⋅y) - P4(x⋅y))/(z(θ,φ)⋅y - x⋅y) for θ in θ, φ in φ]</code></pre><pre><code class="language-none">5×9 Array{Float64,2}:
  4.60889    6.11215    6.63658    5.78535     4.18847    2.80006     2.11673    2.21633     3.09631
  1.63591    4.42049    5.61202    3.73278     1.04275   -0.248156   -0.463973  -0.451025   -0.0647722
 -0.44714    0.316116   0.843534   0.0561656  -0.469624  -0.0830683   0.198439   0.163989   -0.208218
  0.072684  -0.286176  -0.378663  -0.216321    0.168303   0.216675   -0.146482  -0.0647457   0.266239
  0.174701   0.263215   0.273061   0.252482    0.127136  -0.151328   -0.398994  -0.356172   -0.0715676</code></pre><p>We precompute a spherical harmonic–Fourier plan:</p><pre><code class="language-julia">P = plan_sph2fourier(F)</code></pre><pre><code class="language-none">FastTransforms Spherical harmonic--Fourier plan for 5×9-element array of Float64</code></pre><p>And an FFTW Fourier analysis plan on <span>$\mathbb{S}^2$</span>:</p><pre><code class="language-julia">PA = plan_sph_analysis(F)</code></pre><pre><code class="language-none">FastTransforms plan for FFTW Fourier analysis on the sphere for 5×9-element array of Float64</code></pre><p>Its spherical harmonic coefficients demonstrate that it is degree-<span>$3$</span>:</p><pre><code class="language-julia">V = PA*F
U3 = threshold!(P\V, 400*eps())</code></pre><pre><code class="language-none">5×9 Array{Float64,2}:
 2.8263    2.12714  0.573768  0.455803  -0.783431  -0.176704  -0.17848  0.0  0.0
 3.68051   2.92381  0.78866   0.516833  -0.888327   0.0        0.0      0.0  0.0
 2.3975    1.90894  0.514912  0.0        0.0        0.0        0.0      0.0  0.0
 0.685033  0.0      0.0       0.0        0.0        0.0        0.0      0.0  0.0
 0.0       0.0      0.0       0.0        0.0        0.0        0.0      0.0  0.0</code></pre><p>Similarly, on the tensor product grid, the Legendre polynomial <span>$P_4(z\cdot y)$</span> is:</p><pre><code class="language-julia">F = [P4(z(θ,φ)⋅y) for θ in θ, φ in φ]</code></pre><pre><code class="language-none">5×9 Array{Float64,2}:
 -0.0175839   0.524363    0.755924   0.390706   -0.133598  -0.387638   -0.428086  -0.426174   -0.351513
 -0.416115   -0.0716357   0.323254  -0.239853   -0.346307   0.132515    0.335867   0.314703    0.019703
  0.309306   -0.15262    -0.306772  -0.0423671   0.367785   0.0812643  -0.283297  -0.231523    0.20915
 -0.105696    0.277812    0.344612   0.216713   -0.237849  -0.361492    0.243839   0.0980303  -0.423838
 -0.299777   -0.420914   -0.42849   -0.408918   -0.225647   0.252599    0.714592   0.632903    0.110051</code></pre><p>Its spherical harmonic coefficients demonstrate that it is exact-degree-<span>$4$</span>:</p><pre><code class="language-julia">V = PA*F
U4 = threshold!(P\V, 3*eps())</code></pre><pre><code class="language-none">5×9 Array{Float64,2}:
  0.0        0.0       0.0       0.0        0.0        0.0        0.0       -0.0528646  0.0300531
  0.0        0.0       0.0       0.0        0.0       -0.202154  -0.204187   0.0        0.0
  0.0        0.0       0.0       0.363961  -0.625573   0.0        0.0        0.0        0.0
  0.0        0.855921  0.230873  0.0        0.0        0.0        0.0        0.0        0.0
 -0.0171809  0.0       0.0       0.0        0.0        0.0        0.0        0.0        0.0</code></pre><p>The <span>$L^2(\mathbb{S}^2)$</span> norm of the function is:</p><pre><code class="language-julia">nrm1 = norm(U4)</code></pre><pre><code class="language-none">1.1816359006036774</code></pre><p>Finally, the Legendre polynomial <span>$P_4(z\cdot x)$</span> is aligned with the grid:</p><pre><code class="language-julia">F = [P4(z(θ,φ)⋅x) for θ in θ, φ in φ]</code></pre><pre><code class="language-none">5×9 Array{Float64,2}:
  0.562436   0.562436   0.562436   0.562436   0.562436   0.562436   0.562436   0.562436   0.562436
 -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374
  0.375      0.375      0.375      0.375      0.375      0.375      0.375      0.375      0.375
 -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374  -0.398374
  0.562436   0.562436   0.562436   0.562436   0.562436   0.562436   0.562436   0.562436   0.562436</code></pre><p>It only has one nonnegligible spherical harmonic coefficient. Can you spot it?</p><pre><code class="language-julia">V = PA*F
U4 = threshold!(P\V, 3*eps())</code></pre><pre><code class="language-none">5×9 Array{Float64,2}:
 0.0      0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0      0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0      0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0      0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 1.18164  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0</code></pre><p>That nonnegligible coefficient should be approximately <code>√(2π/(4+1/2))</code>, since the convention in this library is to orthonormalize.</p><pre><code class="language-julia">nrm2 = norm(U4)</code></pre><pre><code class="language-none">1.1816359006036774</code></pre><p>Note that the integrals of both functions <span>$P_4(z\cdot y)$</span> and <span>$P_4(z\cdot x)$</span> and their <span>$L^2(\mathbb{S}^2)$</span> norms are the same because of rotational invariance. The integral of either is perhaps not interesting as it is mathematically zero, but the norms of either should be approximately the same.</p><pre><code class="language-julia">nrm1 ≈ nrm2</code></pre><pre><code class="language-none">true</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../padua/">« Padua transform</a><a class="docs-footer-nextpage" href="../spinweighted/">Spin-weighted spherical harmonics »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 7 September 2020 19:27">Monday 7 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
